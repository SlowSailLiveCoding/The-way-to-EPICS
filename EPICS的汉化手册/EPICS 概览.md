### EPICS 概览

###  1.组成

![image-20200523161338299](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200523161338299.png)

如果将整个系统和网络类比的话，那么OPI相当于客户机，可以类比电脑上用的QQ，游戏客户端，做一些显示的工作；IOC相当于服务器，不过这里解释下IOC，intput-output controller，里面东西比较复杂，在整个系统中可以看成是服务器，是用来干活的部件。

LAN的话就是各个系统连接起来的线，用CA协议连接。

### 2.特点

工具集特性；

分布式；

事件驱动；

高性能

### 3.IOC的软件组成：

##### IOC数据库：

内存驻留数据库以及关联的数据结构。每个IOC的核心是一个内存驻留数据库以及描述数据库内容的各种内存驻留结构。EPICS支持大量且可扩展的记录类型集，例如ai（模拟输入），ao（模拟输出）等  每个记录类型都有一个固定的字段集。有些字段是所有记录类型的公共字段，而另一些字段则是特定于特定记录类型的字段。每个记录都有一个记录名称，每个字段都有一个字段名称。每个数据库记录的第一个字段都具有记录名称，该记录名称在连接到同一TCP / IP子网的所有IOC上必须是唯一的。  提供了数据结构，以便可以有效地访问数据库。大多数软件组件由于它们通过数据库访问例程访问数据库，因此不需要了解这些结构。


#####  数据库访问：

数据库访问例程。除记录和设备支持外，所有对数据库的访问都是通过数据库访问例程进行的。

 ##### 扫描程序：

数据库扫描是一种决定何时处理记录的机制。可以进行五种扫描：定期扫描，事件扫描，I / O事件扫描，被动扫描和一次扫描

##### 记录支持：

每种记录类型都有一组相关的记录支持例程。 记录支持、设备支持和设备驱动程序数据库访问不需要特定于记录类型的知识，每个记录类型都提供了一组记录支持例程，这些例程实现了所有记录特定的行为（即对数据库的访问与数据类型无关，而是通过一组记录支持例程来实现）因此，数据库访问可以支持任何数量和类型的记录。同样，记录支持也不包含任何设备专门知识，从而使每种记录类型都可以具有任意数量的独立设备支持模块。如果访问硬件的方法比设备支持所能处理的方法复杂，则可以开发设备驱动程序。
与硬件不相关的记录类型没有设备支持或设备驱动程序。
设计IOC软件的目的是使数据库访问层除了如何调用它之外，对记录支持层一无所知。记录支持层继而对设备支持层一无所知，除了如何调用它。类似地，设备支持层唯一了解其关联驱动程序的是如何调用它。这种设计允许特定的安装甚至安装中的特定IOC选择一组唯一的记录类型，设备类型和驱动程序。IOC系统软件的其余部分未受影响。
（即IOC的数据访问层和设备支持层以及驱动程序之间是相互独立的，它们只拥有调用底层接口的能力，这样可以灵活地使用该系统）
每个记录支持模块都必须提供一个记录处理例程，以供数据库扫描程序调用。记录处理包含以下功能的某种组合：

**输入**：读取输入。可以通过设备支持例程从硬件，通过数据库链接从其他数据库记录或通过通道访问链接从其他IOC获取输入。 

**转换**：将原始输入转换为工程单位，或将工程单位转换为原始输出值。 

**输出**：写入输出。可以通过设备支持例程将输出定向到硬件，通过数据库链接定向到其他数据库记录，或通过通道访问链接定向到其他IOC。 

**引发警报**：检查并引发警报。

 **监视器**：触发与通道访问回调相关的监视器。 

**链接**：触发链接记录的处理。

##### 设备支持：每种记录类型可以具有一组或多组设备支持例程。

#####  设备驱动程序：设备驱动程序访问外部设备。驱动程序可能具有关联的驱动程序中断例程。 频道访问：外部世界与IOC之间的接口。它提供了独立于网络的接口来访问数据库。 

##### 监视器：数据库字段值更改时，将调用数据库监视器。

#####  定序器：有限状态机。



通道访问提供了对IOC数据库的网络透明访问。它基于**客户端/服务器模型**。每个IOC提供一个通道访问服务器，该服务器愿意与任意数量的客户端建立通信。通道访问客户端服务在OPI和IOC上均可用。客户端可以与任意数量的服务器通信。

#### 客户端服务：

##### 基础功能如下：

搜索：找到包含选定过程变量的IOC，并与每个IOC建立通信。 

获取：获取价值以及所选过程变量集的其他可选信息。 

放置：更改所选过程变量的值。 

添加事件：添加状态更改回调。这是要求服务器仅在关联的过程变量更改状态时才发送信息的请求。可以请求以下状态更改的任意组合：值更改，警报状态和/或严重性更改以及档案值更改。许多记录类型为值更改提供了滞后因素。

除了请求过程变量值之外，还可以请求以下附加信息的任意组合：

	状态：警报状态和严重性。
	单位：此过程变量的工程单位。
	精度：显示浮点数的精度。
	时间：上次处理记录的时间。
	枚举：一组ASCII字符串，定义了枚举值的含义。
	图形：产生图形的上限和下限。
	控制：高和低控制极限。
	警报：过程变量的警报HIHI，HIGH，LOW和LOLO值。



应当注意，通道访问不提供对数据库记录的访问作为记录。这是一个故意的设计决定。
这允许添加新的记录类型，而不会影响通过Channel Access访问数据库的任何软件，并且它允许Channel Access客户端与具有不同记录类型集的多个IOC通信。

#### 搜寻服务器

频道访问提供了一个IOC驻留服务器，它等待频道访问搜索消息。
当通道访问客户端（例如，当操作员界面任务启动时）搜索包含客户端使用的过程变量的IOC时，将生成这些变量。该服务器接受所有搜索消息，检查是否有任何过程变量位于此IOC中，如果找到任何过程变量，则使用“我拥有”消息答复发件人。

#### 连接请求服务器

找到过程变量后，通道访问客户端将为每个包含客户端使用的过程变量的IOC发出连接请求。 
IOC中的连接请求服务器接受请求并建立与客户端的连接。
每个连接由两个单独的任务管理：ca_get和ca_put。 
ca_get和ca_put请求映射到dbGetField和dbPutField数据库访问请求。 
ca_add_event请求导致建立数据库监视器。
数据库访问和/或记录支持例程通过对db_post_event的调用来触发监视器。

#### 连接管理

每个IOC提供一个连接管理服务。

当通道访问服务器发生故障（例如，其IOC崩溃）时，将通知客户端；当客户端发生故障（例如，其任务发生崩溃）时，将通知服务器。
当客户端发生故障时，服务器将断开连接。
服务器崩溃时，服务器重新启动时，客户端会自动重新建立通信。

### 5 OPI工具

EPICS提供了许多基于OPI的工具。根据它们是否使用频道访问，可以将它们分为两组。
频道访问工具是实时工具，即用于监视和控制IOC。

#### 通道访问工具的例子

已经开发了大量的通道访问工具。
以下是一些代表性示例。


CSS：Control System Studio，一个带有许多可用插件的Eclipse RCP应用程序。

EDM：可扩展显示管理器。

MEDM：Motif编辑器和显示管理器。

StripTool：通用的strip-chart程序。

ALH：由警报配置文件驱动的通用警报处理程序。

sequencer：在IOC中运行并模拟有限状态机。

probe：允许用户监视和/或更改运行时指定的单个过程变量。

#### 其他例子：

VDCT：基于Java的数据库配置工具，它正迅速成为推荐的数据库配置工具。

SNC：状态符号编译器。它生成一个C程序，该程序代表IOC Sequencer工具的状态。

### 6 EPICS 核心软件

EPICS由一组核心软件和一组可选组件组成。
核心软件，即EPICS的组件，没有EPICS不能运行的软件是：

- Channel Access - Client and Server software

- IOC Database

- Scanners

- Monitors

- Database Deﬁnition Tools

- Source/Release

  

所有其他软件组件都是可选的。
当然，大多数应用程序将需要与MEDM（或EDD / DM）等效的功能。同样，应用程序开发人员也不会从头开始开发记录和设备支持。但是，不必使用大多数OPI工具。同样，可以从特定IOC删除任何给定的记录支持模块，设备支持模块或驱动程序，并且EPICS仍将起作用。